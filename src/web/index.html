<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Debugging Timeline Tool</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container { max-width: 1400px; margin: auto; }

    h1 {
      color: white;
      font-size: 2.5em;
      margin-bottom: 30px;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr 0.9fr;
      gap: 20px;
    }

    @media (max-width: 1200px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    h2 { color: #667eea; margin-bottom: 20px; }

    label { font-weight: 600; margin-top: 12px; display: block; }

    textarea, input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #ddd;
      margin-top: 6px;
      font-family: monospace;
    }

    textarea { min-height: 200px; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .btns {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    button {
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    button.secondary { background: #f5576c; }

    .out {
      margin-top: 12px;
      background: #f4f4f4;
      padding: 12px;
      border-radius: 8px;
      max-height: 250px;
      overflow: auto;
      font-size: 13px;
      white-space: pre-wrap;
    }

    .list {
      margin-top: 16px;
      max-height: 500px;
      overflow-y: auto;
      display: grid;
      gap: 10px;
    }

    .item {
      border: 2px solid #ddd;
      padding: 12px;
      border-radius: 10px;
    }

    .item.active { border-color: #667eea; }

    .badge {
      background: green;
      color: white;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 11px;
      margin-left: 6px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>üêõ Code Debugging Timeline Tool</h1>

  <div class="grid">

    <!-- Editor -->
    <div class="card">
      <h2>Editor</h2>

      <label>Code</label>
      <textarea id="codeText"></textarea>

      <div class="row">
        <div>
          <label>Error Type</label>
          <input id="errorType">
        </div>
        <div>
          <label>Note</label>
          <input id="note">
        </div>
      </div>

      <!-- ‚úÖ BUTTONS UPDATED HERE -->
      <div class="btns">
        <button onclick="saveStep()">Save</button>
        <button onclick="undoStep()" class="secondary">Undo</button>
        <button onclick="markBugFree()">Bug-Free</button>
        <button onclick="jumpBugFree()" class="secondary">Jump</button>

        <button onclick="exportTimeline()">Export</button>
        <button onclick="importTimeline()" class="secondary">Import</button>
      </div>

      <h3>Current Version</h3>
      <pre id="currentBox" class="out">No version loaded</pre>
    </div>

    <!-- Timeline -->
    <div class="card">
      <h2>Timeline</h2>
      <div id="timeline" class="list"></div>
    </div>

    <!-- Analytics -->
    <div class="card">
      <h2>Analytics</h2>
      <div id="analyticsBox"></div>
    </div>

  </div>
</div>

<script>
  const API = "http://localhost:8080";

  let timeline = [];
  let currentIndex = -1;
  let versionCounter = 0;

  function saveStep() {
    const codeText = codeTextEl.value;
    if (!codeText.trim()) return alert("Enter code");

    const v = {
      versionId: ++versionCounter,
      codeText,
      note: note.value || "",
      errorType: errorType.value || "Unknown",
      timestamp: new Date().toISOString(),
      bugFree: false
    };

    timeline.push(v);
    currentIndex = timeline.length - 1;
    refresh();
  }

  function refresh() {
    const wrap = document.getElementById("timeline");
    wrap.innerHTML = "";

    timeline.forEach((v, i) => {
      const div = document.createElement("div");
      div.className = "item" + (i === currentIndex ? " active" : "");
      div.innerHTML = `
        <b>v${v.versionId}</b>
        ${v.bugFree ? '<span class="badge">Bug-Free</span>' : ''}
        <div>${v.note}</div>
        <div>${v.errorType}</div>
      `;
      div.onclick = () => { currentIndex = i; refresh(); };
      wrap.appendChild(div);
    });

    currentBox.textContent = timeline[currentIndex]
      ? JSON.stringify(timeline[currentIndex], null, 2)
      : "No version loaded";
  }

  function undoStep() {
    if (currentIndex > 0) currentIndex--;
    refresh();
  }

  function markBugFree() {
    if (currentIndex >= 0) timeline[currentIndex].bugFree = true;
    refresh();
  }

  function jumpBugFree() {
    for (let i = timeline.length - 1; i >= 0; i--) {
      if (timeline[i].bugFree) {
        currentIndex = i;
        refresh();
        return;
      }
    }
    alert("No bug-free version");
  }

  // ‚úÖ EXPORT
  async function exportTimeline() {
    try {
      const r = await fetch(API + "/export", { method: "POST" });
      const j = await r.json();
      alert(j.message);
    } catch {
      alert("Export failed");
    }
  }

  // ‚úÖ IMPORT
  async function importTimeline() {
    try {
      const r = await fetch(API + "/import", { method: "POST" });
      const j = await r.json();
      alert(j.message);
      location.reload();
    } catch {
      alert("Import failed");
    }
  }

  const codeTextEl = document.getElementById("codeText");
  const note = document.getElementById("note");
  const errorType = document.getElementById("errorType");
  const currentBox = document.getElementById("currentBox");
</script>
</body>
</html>
